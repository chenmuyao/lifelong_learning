# 硬学C++之书店的烦恼

**<u>知识清单：</u>**

- C++ 程序后缀： .cc , .cxx , .cpp , .cp , .C

- `echo $?` 看函数返回值

- 输入输出流（stream）之所以成为流，是因为字符是随时序产生和处理——联想到时序电路中的**寄存器**

- `cin cout cerr clog`     **c**代表standard. 标准输入/输出是从程序执行的**窗口**接受输入，释放输出。这个窗口究竟指向哪里呢？

  - ```sh
    	   Under normal circumstances every UNIX program has three streams
           opened for it when it starts up, one for input, one for output, and
           one for printing diagnostic or error messages.  These are typically
           attached to the user's terminal (see tty(4)) but might instead refer
           to files or other devices, depending on what the parent process chose
           to set up.  (See also the "Redirection" section of sh(1).)
    ```
  - 根据Linux man可知，窗口指向用户tty，但同时也可以重新定向 `>, <`

- `g++ -o prog prog.c` 一个option跟一个对应的目标。-o 和 prog 永远连在一起。
-  `::` scope operator ： 指名函数所属**namespace** 
- `>> <<` Input/Output operator : 输入输出运算符
  - 输入：`std::cin >> v1 >> v2;` == `(std::cin >> v1) >> v2;` == `std::cin >> v1; std::cin >> v2; 运算顺序从左向右，将左值赋予右侧变量。`
  - 输出 ： `std::cout << "Enter two numbers:" << std::endl;` == `(std::cout << "Enter two numbers:") << std::endl;` == `std::cout << "Enter two numbers:"; std::cout << std::endl;` 将右值赋予左侧输出。
  - `endl` (manipulator) 标志一行的结束（回车换行），然后将buffer中所有待输出的内容输出。



**起手从一个案例出发，然后逐步引入最基本的概念，先上路，再慢慢学**。  

案例如下，一家书店，要登记销售信息，每本书都有特定的ISBN号，每本书还须计算售出的数量和当时售出的价格，以便以后计算每本书的销售额及均价。

首先拆解问题，要完成这项任务，

1. 定义变量
2. 输入输出
3. 使用一个数据结构去存放数据
4. 加入数据的时候查询是否有重复（是新建还是增加）
5. 循环完成以上任务
6. 计算总价和均价

拆解完任务之后就需要一步一步解决问题。最简单的是**定义变量**和**输入输出**，再其次**使用循环**也相对简单，涉及的都是基本语法知识。只是用什么**数据结构**，如何**存放数据**，以及如何**查找数据**比较麻烦，隐隐然觉得有很多方法，不同的方法之间效率也会有所不同。

C语言中定义的简单数据结构**数组**需要要求统一**类型**，原因是这样比较方便分配内存空间和初始化指针。倘若用数组来完成应该怎么办呢？我有三个数据类型：**ISBN号**（字符串类型），**价格**（浮点型）和**数量**（整形）。我使用一个数组来存储ISBN号，每一个ISBN号对应一个数量，这样ISBN和数量的数组是等长的。如果插入一本新书，我就在ISBN数组最后加入这个新的ISBN，同时在数量数组的最后加一个1；如果是插入一本已有书籍，我就找到对应的ISBN，比如是数组中第五个，然后把数量数组的第五个自增1。直到现在都是可以实现的，唯独价格要棘手一些。价格数组的长度是和其他两个数组不相等的，因为我需要记录每一本书的价格，即使有重复，也得继续记录。所以记录的时候相对方便，但是查找起来就很麻烦了。

假如我输入书的顺序是ABABA。ISBN数组里就会有两个元素：A和B，数量数组里也有两个元素：3和2，分别与AB对应。但是价格数组里就可能是`[15 2 13 6 17]`，接下来我如何计算AB每本书所对应的总价和均价呢？

**看来顺序存储不行**，我必须要把价格数组里面的书分类之后存储：

```c
价格[] = [15]
价格[] = [15 2]
价格[] = [15 13 2]
价格[] = [15 13 2 6]
价格[] = [15 13 17 2 6]
```

这样以来我就可以利用**数量**来查询和计算每本书的价格信息。功能总算是可以实现了，可是这么去处理总是十分别扭，如果我增加关于书的种类、作者、出版商、出版年份……如果继续用这种方式处理，很快就超出了我思考能力的上限。有没有其他的方法呢？C语言确实提供了一种解决方案——**结构体**。所谓结构体就是**把不同的数据结构组织在一起的一个结构**。而这个被**包装起来的复杂结构**可以当作一个**普通的结构**来使用。这也就逼近了“**面向对象**”的编程方式。

***总结一下：***

今天我们看到一个需要解决的实例问题，面对一个具体问题，首先要将其分类抽象，统一的任务统一解决（比如输入输出），等到每个抽象问题解决之后还需要还原成具体的解决方案。同时，我们也分析了一个**原始的一维的**数据结构如何解决多维问题，以及这种方法的局限。面对复杂问题，我们要能够使用**封装思维**，不被每一个细节所左右，从更加抽象的整体来切入。

